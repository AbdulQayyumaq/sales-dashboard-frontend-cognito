(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{1296:function(){},6800:function(e,t,o){Promise.resolve().then(o.bind(o,3515)),Promise.resolve().then(o.t.bind(o,3445,23)),Promise.resolve().then(o.t.bind(o,2445,23))},3515:function(e,t,o){"use strict";o.r(t),o.d(t,{AuthContext:function(){return u},AuthProvider:function(){return w},useAuth:function(){return d}});var n=o(7437),a=o(2265),r=o(4327);let l="https://salesgames-dashboard.auth.us-east-1.amazoncognito.com",c="62ua8j7k3svfqka13bv9f7kakm";function i(e){try{let t=e.split(".");if(3!==t.length)return null;let o=t[1],n=atob(o.replace(/-/g,"+").replace(/_/g,"/"));return JSON.parse(n)}catch(e){return null}}async function s(e){let t=new TextEncoder().encode(e),o=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(o),a="";return n.forEach(e=>{a+=String.fromCharCode(e)}),btoa(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}let u=(0,a.createContext)(void 0);function d(){let e=(0,a.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function w(e){let{children:t}=e,[o,d]=(0,a.useState)(null),[w,f]=(0,a.useState)(!0),[m,g]=(0,a.useState)(null);(0,a.useEffect)(()=>{h()},[]);let h=async()=>{f(!0);try{let e=window.localStorage.getItem("access_token")||"",t=window.localStorage.getItem("id_token")||"";if(!e&&!t){d(null);return}let o=t?i(t):i(e);if(o){let e={id:String(o.sub||o.username||""),name:String(o.name||o.email||""),email:String(o.email||"")};d(e);let t=Number(o.exp||0);if(t){let e=Math.floor(Date.now()/1e3);setTimeout(()=>_(),Math.max((t-e-60)*1e3,5e3))}}else d(null)}finally{f(!1)}},_=async()=>{let e=window.localStorage.getItem("refresh_token")||"";if(!e)return;let t=l.replace(/\/$/,""),o=new URLSearchParams({grant_type:"refresh_token",client_id:c,refresh_token:e}),n=await fetch("".concat(t,"/oauth2/token"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()});if(n.ok){let e=await n.json(),t=e.access_token||"",o=e.id_token||"";t&&window.localStorage.setItem("access_token",t),o&&window.localStorage.setItem("id_token",o),h()}},p=async()=>{g(null);let e=l.replace(/\/$/,""),t=function(){let e=new Uint8Array(32);crypto.getRandomValues(e);let t="";return e.forEach(e=>{t+=("0"+e.toString(16)).slice(-2)}),t}(),o=await s(t);{window.localStorage.setItem("pkce_verifier",t);let n="".concat(e,"/oauth2/authorize?client_id=").concat(encodeURIComponent(c),"&redirect_uri=").concat(encodeURIComponent("http://localhost:3000/callback"),"&response_type=code&scope=").concat(encodeURIComponent("openid email profile"),"&code_challenge_method=S256&code_challenge=").concat(o);window.location.assign(n)}},k=async()=>{f(!0);{window.localStorage.removeItem("access_token"),window.localStorage.removeItem("id_token"),window.localStorage.removeItem("refresh_token"),window.localStorage.removeItem("pkce_verifier"),d(null);let e=l.replace(/\/$/,""),t="".concat(e,"/logout?client_id=").concat(encodeURIComponent(c),"&logout_uri=").concat(encodeURIComponent("http://localhost:3000"));window.location.assign(t)}f(!1)};return(0,n.jsx)(u.Provider,{value:{user:o,login:p,loginWithCredentials:async(e,t)=>{f(!0),g(null);try{let o=new r.AM({UserPoolId:"us-east-1_Ekr0Fg6xJ",ClientId:c}),n=new r.ws({Username:e,Pool:o}),a=new r.sD({Username:e,Password:t});await new Promise((e,t)=>{n.authenticateUser(a,{onSuccess:t=>{var o;let n=t.getAccessToken().getJwtToken(),a=t.getIdToken().getJwtToken(),r=(null===(o=t.getRefreshToken())||void 0===o?void 0:o.getToken())||"";n&&window.localStorage.setItem("access_token",n),a&&window.localStorage.setItem("id_token",a),r&&window.localStorage.setItem("refresh_token",r),e()},onFailure:e=>t(e),newPasswordRequired:()=>t(Error("New password required"))})}),await h()}catch(e){throw g((null==e?void 0:e.message)||"Login failed"),e}finally{f(!1)}},logout:k,isLoading:w,error:m},children:t})}},2445:function(){},3445:function(e){e.exports={style:{fontFamily:"'__Inter_f367f3', '__Inter_Fallback_f367f3'",fontStyle:"normal"},className:"__className_f367f3"}}},function(e){e.O(0,[378,971,938,744],function(){return e(e.s=6800)}),_N_E=e.O()}]);