"use strict";exports.id=568,exports.ids=[568],exports.modules={9568:(e,t,r)=>{r.d(t,{EventStreamSerde:()=>s});var i=r(2695);class s{constructor({marshaller:e,serializer:t,deserializer:r,serdeContext:i,defaultContentType:s}){this.marshaller=e,this.serializer=t,this.deserializer=r,this.serdeContext=i,this.defaultContentType=s}async serializeEventStream({eventStream:e,requestSchema:t,initialRequest:r}){let i=this.marshaller,s=t.getEventStreamMember(),a=t.getMemberSchema(s),n=this.serializer,l=this.defaultContentType,o=Symbol("initialRequestMarker"),m={async *[Symbol.asyncIterator](){if(r){n.write(t,r);let e=n.flush();yield{[o]:!0,headers:{":event-type":{type:"string",value:"initial-request"},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:l}},body:e}}for await(let t of e)yield t}};return i.serialize(m,e=>{if(e[o])return{headers:e.headers,body:e.body};let t=Object.keys(e).find(e=>"__type"!==e)??"",{additionalHeaders:r,body:i,eventType:s,explicitPayloadContentType:n}=this.writeEventBody(t,a,e);return{headers:{":event-type":{type:"string",value:s},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:n??l},...r},body:i}})}async deserializeEventStream({response:e,responseSchema:t,initialResponseContainer:r}){let i=this.marshaller,s=t.getEventStreamMember(),a=t.getMemberSchema(s).getMemberSchemas(),n=Symbol("initialResponseMarker"),l=i.deserialize(e.body,async e=>{let r=Object.keys(e).find(e=>"__type"!==e)??"";if("initial-response"===r){let i=await this.deserializer.read(t,e[r].body);return delete i[s],{[n]:!0,...i}}if(!(r in a))return{$unknown:e};{let t=a[r];return{[r]:await this.deserializer.read(t,e[r].body)}}}),o=l[Symbol.asyncIterator](),m=await o.next();if(m.done)return l;if(m.value?.[n]){if(!t)throw Error("@smithy::core/protocols - initial-response event encountered in event stream but no response schema given.");for(let[e,t]of Object.entries(m.value))r[e]=t}return{async *[Symbol.asyncIterator](){for(m?.value?.[n]||(yield m.value);;){let{done:e,value:t}=await o.next();if(e)break;yield t}}}}writeEventBody(e,t,r){let s;let a=this.serializer,n=e,l=null,o=t.getSchema()[4].includes(e),m={};if(o){let i=t.getMemberSchema(e);if(i.isStructSchema()){for(let[t,s]of i.structIterator()){let{eventHeader:i,eventPayload:a}=s.getMergedTraits();if(a){l=t;break}if(i){let i=r[e][t],a="binary";s.isNumericSchema()?a=-2147483648<=i&&i<=2147483648-1?"integer":"long":s.isTimestampSchema()?a="timestamp":s.isStringSchema()?a="string":s.isBooleanSchema()&&(a="boolean"),null!=i&&(m[t]={type:a,value:i},delete r[e][t])}}if(null!==l){let t=i.getMemberSchema(l);t.isBlobSchema()?s="application/octet-stream":t.isStringSchema()&&(s="text/plain"),a.write(t,r[e][l])}else a.write(i,r[e])}else throw Error("@smithy/core/event-streams - non-struct member not supported in event stream union.")}else{let[t,i]=r[e];n=t,a.write(15,i)}let y=a.flush();return{body:"string"==typeof y?(this.serdeContext?.utf8Decoder??i.$)(y):y,eventType:n,explicitPayloadContentType:s,additionalHeaders:m}}}}};